#!/bin/bash
#DRYRUN=echo

if [ $# -lt 2 ] ; then
    cat << __HELP__
usage: $(basename "$0") template VAR1 [VARIABLES ..]

Generates an SVG file from the base SVG file $BASE, updating the occourence or %VAR1% [...] in the file with the content of the environment variable VAR1. The file will be generated by the FILE environment var.

__HELP__
    exit 1
fi

[ -z "$FILE" ] && echo ERROR: FILE variable must be defined. && exit 1

TEMPLATE="$1"
shift
output="$FILE"
[ ! -f "$TEMPLATE" ] && echo ERROR: template file $TEMPLATE does not exist! && exit 1

$DRYRUN cp "$TEMPLATE" "$output"

for VAR in "$@" ; do
    #echo Applying $VAR ...
    #$DRYRUN sed -z -i -e "/%${VAR}%/ s//${!VAR}/" "$output"
    VALUE=${!VAR}
    [ "$VALUE" = '""' ] && VALUE=""

    #echo awk -i inplace -v "r=${VALUE}" "{gsub(/%$VAR%/,r)}1" "$output"
    $DRYRUN awk -i inplace -v "r=${VALUE}" "{gsub(/%$VAR%/,r)}1" "$output"

done

exit 0
